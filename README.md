This is the sample code for imapi from Microsoft Win7Samples with a very small update to initialise the COM library as documented here
https://docs.microsoft.com/en-us/windows/win32/learnwin32/initializing-the-com-library I assume this must have become required at some point in Windows 
timeline after the original demo code was written, because when I first ran the sample code it errored saying the Com library had not been initialised. 
